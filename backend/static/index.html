<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Reading Agent System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .markdown-body h1 { font-size: 1.5rem; font-weight: bold; margin-top: 1rem; }
        .markdown-body h2 { font-size: 1.25rem; font-weight: bold; margin-top: 0.8rem; }
        .markdown-body ul { list-style-type: disc; margin-left: 1.5rem; }
        .markdown-body p { margin-bottom: 0.5rem; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" v-cloak class="container mx-auto px-4 py-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ü§ñ Paper Reading Agent</h1>
            <p class="text-gray-600">Automated Computer Science Paper Analysis System</p>
        </header>

        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-2xl mx-auto">
            <div class="flex gap-4 mb-4">
                <button 
                    @click="inputType = 'url'"
                    :class="['px-4 py-2 rounded', inputType === 'url' ? 'bg-blue-600 text-white' : 'bg-gray-200']"
                >Paper URL</button>
                <button 
                    @click="inputType = 'title'"
                    :class="['px-4 py-2 rounded', inputType === 'title' ? 'bg-blue-600 text-white' : 'bg-gray-200']"
                >Paper Title</button>
            </div>
            
            <div class="flex gap-2">
                <input 
                    v-model="inputValue"
                    type="text" 
                    :placeholder="inputType === 'url' ? 'Enter ArXiv URL...' : 'Enter Paper Title...'"
                    class="flex-1 p-3 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                    @keyup.enter="analyzePaper"
                >
                <button 
                    @click="analyzePaper"
                    :disabled="loading"
                    class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 disabled:opacity-50 font-semibold"
                >
                    {{ loading ? 'Analyzing...' : 'Analyze' }}
                </button>
            </div>
        </div>

        <!-- Progress Section -->
        <div v-if="currentTask" class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-2xl mx-auto">
            <h3 class="font-bold text-lg mb-4">Processing Status</h3>
            <div class="flex items-center gap-4">
                <div class="flex-1 bg-gray-200 rounded-full h-4">
                    <div 
                        class="bg-green-500 h-4 rounded-full transition-all duration-500"
                        :style="{ width: progressPercentage + '%' }"
                    ></div>
                </div>
                <span class="text-sm font-medium text-gray-700">{{ currentTask.status }}</span>
            </div>
            <p class="text-gray-500 mt-2 text-sm">{{ currentTask.message }}</p>
        </div>

        <!-- Result Section -->
        <div v-if="result" class="bg-white rounded-lg shadow-xl p-8 max-w-4xl mx-auto">
            <div class="border-b pb-6 mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">{{ result.metadata.title }}</h2>
                <div class="text-gray-600 mb-4">
                    <span v-for="author in result.metadata.authors" :key="author" class="mr-4 text-sm font-medium bg-gray-100 px-2 py-1 rounded">{{ author }}</span>
                </div>
                <div class="flex gap-4 text-sm text-gray-500">
                    <span>üìÖ {{ formatDate(result.metadata.published_date) }}</span>
                    <a v-if="result.metadata.pdf_url" :href="result.metadata.pdf_url" target="_blank" class="text-blue-600 hover:underline">üìÑ View PDF</a>
                    <a v-if="result.code_analysis && result.code_analysis.repository_url" :href="result.code_analysis.repository_url" target="_blank" class="text-gray-800 hover:underline">üíª GitHub Repo</a>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Analysis Column -->
                <div class="space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-bold text-blue-900 mb-2 text-lg">üéØ Research Motivation</h3>
                        <p class="text-gray-800 leading-relaxed">{{ result.analysis.motivation }}</p>
                    </div>

                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-bold text-green-900 mb-2 text-lg">üí° Key Innovations</h3>
                        <ul class="list-disc list-inside space-y-1 text-gray-800">
                            <li v-for="(item, idx) in result.analysis.key_innovations" :key="idx">{{ item }}</li>
                        </ul>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="font-bold text-purple-900 mb-2 text-lg">‚öôÔ∏è Methodology</h3>
                        <p class="text-gray-800 text-sm leading-relaxed">{{ result.analysis.methodology }}</p>
                    </div>
                </div>

                <!-- Code & Framework Column -->
                <div class="space-y-6">
                    <div v-if="result.code_analysis && result.code_analysis.has_code" class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h3 class="font-bold text-gray-900 mb-3 text-lg">üíª Code Analysis</h3>
                        <div class="space-y-3">
                            <div>
                                <span class="text-xs font-bold text-gray-500 uppercase">Tech Stack</span>
                                <div class="flex flex-wrap gap-2 mt-1">
                                    <span v-for="tech in result.code_analysis.tech_stack" :key="tech" class="text-xs bg-gray-200 px-2 py-1 rounded">{{ tech }}</span>
                                </div>
                            </div>
                            <div>
                                <span class="text-xs font-bold text-gray-500 uppercase">Key Algorithms</span>
                                <ul class="text-sm list-disc list-inside text-gray-700 mt-1">
                                    <li v-for="algo in result.code_analysis.key_algorithms" :key="algo">{{ algo }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="bg-orange-50 p-4 rounded-lg border border-orange-100">
                        <h3 class="font-bold text-orange-900 mb-2 text-lg">üìä Framework Diagram</h3>
                        <div class="bg-white p-4 rounded border border-orange-100 text-sm text-gray-600 italic">
                            {{ result.framework_diagram_desc }}
                            <br><br>
                            <span class="text-xs not-italic text-gray-400">* Visual diagram generation requires integration with Mermaid/Graphviz (Placeholder)</span>
                        </div>
                    </div>
                    
                    <div v-if="result.analysis.limitations" class="bg-red-50 p-4 rounded-lg">
                         <h3 class="font-bold text-red-900 mb-2 text-lg">‚ö†Ô∏è Limitations</h3>
                         <p class="text-gray-800 text-sm">{{ result.analysis.limitations }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div v-if="history.length > 0" class="mt-12 max-w-4xl mx-auto">
            <h3 class="text-xl font-bold mb-4 text-gray-700">Analysis History</h3>
            <div class="grid gap-4">
                <div 
                    v-for="task in history" 
                    :key="task.task_id" 
                    class="bg-white p-4 rounded shadow hover:shadow-md transition cursor-pointer flex justify-between items-center"
                    @click="loadTask(task)"
                >
                    <div>
                        <div class="font-bold text-gray-800">{{ task.result ? task.result.metadata.title : 'Processing...' }}</div>
                        <div class="text-sm text-gray-500">{{ formatDate(task.created_at) }}</div>
                    </div>
                    <span 
                        :class="['px-3 py-1 rounded text-xs font-bold uppercase', 
                            task.status === 'completed' ? 'bg-green-100 text-green-800' : 
                            task.status === 'failed' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800']"
                    >
                        {{ task.status }}
                    </span>
                </div>
            </div>
        </div>

    </div>
    <script src="/static/app.js"></script>
</body>
</html>
